---
title: "Median-odds-ratio"
author: "Steve Simon"
date: "May 10, 2017"
output: html_document
---

This program explores the median odds ratio, a measure of the size of a random effect in a random effects logistic regression model.

```{r preliminaries}
library(broom)
library(dplyr)
library(ggplot2)
library(lme4)
library(magrittr)
```

This data set represents the number of cancer cells out of 400 that were killed by a radiation exposure. There were 27 experiments run, 3 per day across 9 different days.

```{r read-data}
f <- "http://www.statsci.org/data/general/radiatio.txt"
radiation <- read.table(file=f, header=TRUE)
radiation %<>% mutate(p=Survived/400) %>% mutate(label="Raw data")
print(radiation)
summary(radiation$p)
```

Let's plot the data, ignoring the day.

```{r plot, fig.width=7, fig.height=1}
radiation                                       %>%
  ggplot(aes(label, p))                          +
  geom_boxplot()                                 +
  expand_limits(y=c(0,1))                        +
  coord_flip()
```

It may not be obvious, but the data you are looking at is too variable to come from a binomial distribution.

```{r compare-to-simulation, fig.width=7, fig.height=1.33}
n <- dim(radiation)[1]
simulated_binomial <- rbinom(n, 400, mean(radiation$p))/400
tibble(p=simulated_binomial,
  label="Simulated binomial")                   %>%
  bind_rows(radiation)                          %>%
  ggplot(aes(label, p))                          +
  geom_boxplot()                                 +
  expand_limits(y=c(0,1))                        +
  coord_flip()



```

A plot of the probabilities by day shows why the data is more variable than the simulation.

```{r scatterplot, fig.width=4, fig.height=4}
radiation                                       %>%
  ggplot(aes(factor(Occasion), p))                       +
  expand_limits(y=c(0,1))                                +
  geom_point()
```

There is significant day-to-day variation. How would you model that variation?

```{r glm}
random_days <- glmer(cbind(Survived, 400-Survived) ~ 1 | Occasion, data=radiation, family=binomial)
summary(random_days)
glance(random_days)
tidy(random_days)
augment(random_days, radiation)
```

The question is how big and important this random effect is. In a linear regression model, you can compute the intraclass correlation, which is a measure of the strength of the correlation between two observations from the same level of the random effect. It is computed as

$\rho_{ICC}=SD_B/(SD_B+SD_W)$

where $SD_B$ is the between group standard deviation and $SD_W$ is the within group standard deviation. But when you look at the summary output, there is no within group standard deviation. You could use the formula for the standard deviation of a binomial random variable. But this variance is on the probability scale and the between group variance is on the log odds scale.

A new statistic has been proposed, the median odds ratio, for the random effects logistic regression. It is defined as 

$MOR = exp(\sqrt{2\sigma_A}Z_.75)$

# end of file